var re=Object.defineProperty;var ae=(_,f,r)=>f in _?re(_,f,{enumerable:!0,configurable:!0,writable:!0,value:r}):_[f]=r;var W=(_,f,r)=>(ae(_,typeof f!="symbol"?f+"":f,r),r);import{_ as oe,a as se}from"./subtitle.37a41f5a.js";import{_ as le}from"./accept.20c03ca9.js";import{_ as ne,u as ue,N as D,a as ce}from"./megaman-status.55511e13.js";import{e as T,r as P,o as h,c as $,w as m,q as i,k as I,j,p as N,F as q,t as U,u as C,v as F,s as B,B as X,a as G,l as E,A as L,y as H,m as J,x as ie,h as me,i as de,f as ge}from"./entry.5c6953ce.js";import{V as _e}from"./VDataTable.1617ad9e.js";const pe=T({__name:"navi-customizer-status",props:{naviCustomizerStatus:{type:Object,required:!0}},setup(_){return(f,r)=>{const c=ne,p=P("v-card");return h(),$(p,{height:"100%"},{default:m(()=>[i(c,{"megaman-status":_.naviCustomizerStatus.megamanStatus,"max-capacity":0,"current-capacity":0},null,8,["megaman-status","max-capacity","current-capacity"])]),_:1})}}}),ve=["red","blue","green","yellow","pink","white"],k=11,fe=T({__name:"navi-customizer",props:{cells:{type:Array,required:!0},selectedProgram:{type:Object,required:!1,default:null},programState:{type:Object,required:!1,default:null}},emits:["add-program","remove-program"],setup(_,{emit:f}){const r=_,c=I({x:0,y:0}),p=j(()=>{var s,g;const t=[];for(let l=0;l<k;l+=1){t.push([]);for(let a=0;a<k;a+=1)t[l].push({programId:null,registeredProgramId:null,color:"transparent"})}for(let l=0;l<r.cells.length;l+=1)for(let a=0;a<r.cells[l].length;a+=1)t[l+2][a+2]=r.cells[l][a];if(c.value.x!==null&&c.value.y!==null){const l=r.programState.isCompressed?(s=r.selectedProgram)==null?void 0:s.compressedCells:(g=r.selectedProgram)==null?void 0:g.cells;l&&l.forEach((a,n)=>{a.forEach((o,u)=>{if(!(c.value.y+n<0||c.value.y+n>=k)&&!(c.value.x+u<0||c.value.x+u>=k)&&o){let e,d;switch(r.programState.rotate){case 0:e=n,d=u;break;case 1:e=l.length-u-1,d=n;break;case 2:e=l.length-n-1,d=l[n].length-u-1;break;case 3:e=u,d=l[n].length-n-1;break;default:e=n,d=u;break}if(c.value.y+e<0||c.value.y+e>=k||c.value.x+d<0||c.value.x+d>=k)return;t[c.value.y+e][c.value.x+d]&&(t[c.value.y+e][c.value.x+d]={programId:r.selectedProgram.id,color:r.selectedProgram.color,isProgram:r.selectedProgram.isProgram})}})})}return t}),v=(t,s)=>{c.value={x:s,y:t}},S=()=>{c.value={x:null,y:null}},b=(t,s)=>{var l,a;const g=r.programState.isCompressed?(l=r.selectedProgram)==null?void 0:l.compressedCells:(a=r.selectedProgram)==null?void 0:a.cells;if(g){let n=!1;for(let o=0;o<g.length;o+=1)for(let u=0;u<g[o].length;u+=1)if(g[o][u]){let e,d;switch(r.programState.rotate){case 0:e=o,d=u;break;case 1:e=g.length-u-1,d=o;break;case 2:e=g.length-o-1,d=g[o].length-u-1;break;case 3:e=u,d=g[o].length-o-1;break;default:e=o,d=u;break}if(t+e<2||t+e>=k-2||s+d<2||s+d>=k-2||t+e===2&&s+d===2||t+e===2&&s+d===k-3||t+e===k-3&&s+d===2||t+e===k-3&&s+d===k-3||ve.includes(r.cells[t+e-2][s+d-2].color))return;t+e>=3&&t+e<=7&&s+d>=3&&s+d<=7&&(n=!0)}if(!n)return}f("add-program",{x:s-2,y:t-2},r.programState.value)},y=(t,s)=>{const{targetY:g,targetX:l}={targetY:t-2,targetX:s-2},{registeredProgramId:a}=r.cells[g][l];a&&f("remove-program",a,null)},w=(t,s)=>{r.selectedProgram?b(t,s):y(t,s)},z=(t,s)=>{let[g,l,a,n]=[!0,!0,!0,!0];const o=p.value[t][s];return t>0&&p.value[t-1][s].programId===o.programId&&(g=!1),t<k-1&&p.value[t+1][s].programId===o.programId&&(l=!1),s<k-1&&p.value[t][s+1].programId===o.programId&&(a=!1),s>0&&p.value[t][s-1].programId===o.programId&&(n=!1),{transparent:p.value[t][s].color==="transparent","elevation-0":p.value[t][s].color==="transparent","has-border-top":g,"has-border-bottom":l,"has-border-right":a,"has-border-left":n}};return(t,s)=>{const g=P("v-icon"),l=P("v-card");return h(),$(l,{class:"pa-8"},{default:m(()=>[(h(!0),N(q,null,U(C(p),(a,n)=>(h(),N("div",{key:n,class:"grid"},[(h(!0),N(q,null,U(a,(o,u)=>(h(),N("div",{key:u},[i(l,{class:F(["pa-5 elevation-1 rounded-0 cell",z(n,u)]),width:"100%",height:"100%",color:o.color,onMouseenter:e=>v(n,u),onMouseleave:s[0]||(s[0]=e=>S()),onClick:e=>w(n,u)},{default:m(()=>[o.programId&&!o.isProgram?(h(),$(g,{key:0,color:"grey-darken-3",class:"plus-part"},{default:m(()=>[B(" mdi-plus ")]),_:1})):X("",!0)]),_:2},1032,["class","color","onMouseenter","onClick"])]))),128))]))),128))]),_:1})}}});const he=G(fe,[["__scopeId","data-v-e0da6073"]]);class K{}W(K,"colorToTextMap",{red:"赤",blue:"青",green:"緑",yellow:"黄",pink:"ピンク",white:"白"});const Pe=T({__name:"navi-customizer-program",props:{programs:{type:Array,required:!0},selectedProgram:{type:Object,required:!1,default:null}},emits:["update-selected-program"],setup(_,{emit:f}){const r=_,c=I(""),p=I(10),v=I([]),S=[{title:"名前",key:"name",align:"center",sortable:!0},{title:"プログラムパーツ",key:"isProgram",align:"center",sortable:!0},{title:"色",key:"color",align:"center",sortable:!0}];return E(v,b=>{b.length===0?f("update-selected-program",null):f("update-selected-program",b[0])}),E(r,()=>{r.selectedProgram&&(v.value=[r.selectedProgram])}),(b,y)=>{const w=P("v-text-field"),z=P("v-icon");return h(),N(q,null,[i(w,{modelValue:C(c),"onUpdate:modelValue":y[0]||(y[0]=t=>L(c)?c.value=t:null),"append-icon":"mdi-magnify",label:"検索","single-line":"","hide-details":""},null,8,["modelValue"]),i(C(_e),{modelValue:C(v),"onUpdate:modelValue":y[1]||(y[1]=t=>L(v)?v.value=t:null),"items-per-page":C(p),headers:S,items:_.programs,search:C(c),"item-value":"name",class:"elevation-1","multi-sort":"",density:"compact","show-select":"","return-object":"","select-strategy":"single"},{["item.isProgram"]:m(t=>[t.item.selectable.isProgram?(h(),$(z,{key:0},{default:m(()=>[B(" mdi-check ")]),_:1})):X("",!0)]),["item.color"]:m(t=>[B(H(C(K).colorToTextMap[t.item.selectable.color]),1)]),_:2},1032,["modelValue","items-per-page","items","search"])],64)}}}),Ce={class:"program"},be=T({__name:"navi-customizer-program",props:{naviCustomizerProgram:{type:Object,required:!1,default:null}},emits:["update-program-state"],setup(_,{emit:f}){const r=_,c=I(0),p=I({isCompressed:!0,rotate:0});J(()=>{});const v=I(5),S=I(!0),b=j(()=>Math.max(r.naviCustomizerProgram.cells.length,r.naviCustomizerProgram.cells[0].length)),y=j(()=>{let g=0;switch(b.value){case 1:case 2:g=2;break;case 3:case 4:g=1;break;case 5:g=0;break;default:g=0;break}const l=[];for(let a=0;a<v.value;a++){const n=[];for(let o=0;o<v.value;o++)n.push(!1);l.push(n)}for(let a=0;a<r.naviCustomizerProgram.cells.length;a++)for(let n=0;n<r.naviCustomizerProgram.cells[a].length;n++){let o,u;switch(c.value){case 0:o=a,u=n;break;case 1:o=n,u=r.naviCustomizerProgram.cells[a].length-a-1;break;case 2:o=r.naviCustomizerProgram.cells[a].length-a-1,u=r.naviCustomizerProgram.cells[a].length-n-1;break;case 3:o=r.naviCustomizerProgram.cells[a].length-n-1,u=a;break;default:o=a,u=n;break}l[a+g][n+g]=S.value?r.naviCustomizerProgram.compressedCells[o][u]:r.naviCustomizerProgram.cells[o][u]}return l}),w=()=>{f("update-program-state",p.value)},z=()=>{c.value=(c.value+1)%4,p.value.rotate=c.value,w()},t=()=>{c.value=(c.value+3)%4,p.value.rotate=c.value,w()},s=()=>{p.value.isCompressed=S.value,w()};return(g,l)=>{const a=P("v-card-title"),n=P("v-switch"),o=P("v-row"),u=P("v-icon"),e=P("v-btn"),d=P("v-col"),R=P("v-card"),V=P("v-container");return h(),$(R,{class:"container pa-2",width:"100%",height:"100%"},{default:m(()=>[_.naviCustomizerProgram?(h(),N(q,{key:0},[i(a,null,{default:m(()=>[B(H(_.naviCustomizerProgram.name),1)]),_:1}),i(V,null,{default:m(()=>[i(o,null,{default:m(()=>[i(n,{modelValue:C(S),"onUpdate:modelValue":l[0]||(l[0]=x=>L(S)?S.value=x:null),label:"圧縮",onChange:s},null,8,["modelValue"])]),_:1}),i(o,{class:"mb-4"},{default:m(()=>[i(d,null,{default:m(()=>[i(e,{onClick:z},{default:m(()=>[i(u,null,{default:m(()=>[B(" mdi-rotate-left ")]),_:1})]),_:1})]),_:1}),i(d,{align:"right"},{default:m(()=>[i(e,{onClick:t},{default:m(()=>[i(u,null,{default:m(()=>[B(" mdi-rotate-right ")]),_:1})]),_:1})]),_:1})]),_:1}),ie("div",Ce,[(h(!0),N(q,null,U(C(y),(x,O)=>(h(),N("div",{key:O,class:"row"},[(h(!0),N(q,null,U(x,(M,A)=>(h(),N("div",{key:A,class:"col"},[i(R,{class:F(["elevation-0 rounded-0 cell d-flex align-center justify-center",{filled:M}]),width:"100%",height:"100%",color:M?_.naviCustomizerProgram.color:"transparent"},{default:m(()=>[M&&!_.naviCustomizerProgram.isProgram?(h(),$(u,{key:0,color:"grey-darken-3",style:{"font-size":"70px",opacity:"20%"}},{default:m(()=>[B(" mdi-plus ")]),_:1})):X("",!0)]),_:2},1032,["class","color"])]))),128))]))),128))])]),_:1})],64)):(h(),$(a,{key:1},{default:m(()=>[B(" プログラムが選択されていません ")]),_:1}))]),_:1})}}});const ke=G(be,[["__scopeId","data-v-3a002fef"]]),Ie=T({__name:"navi",setup(_){const f=me(),r=de(),c=ue(),p=j(()=>c.programs),v=I(new D),S=j(()=>v.value.cells),b=I(null),y=I({isCompressed:!0,rotate:0}),w=ge(),z=j(()=>w.selectedBuild),t=ce(),s=j(()=>t.naviCustomizerStatus),g=()=>{z.value&&(v.value=new D,z.value.registeredNaviCustomizerPrograms.forEach(e=>{v.value.addProgram(e)}))};E(z,e=>{e&&g()},{deep:!0}),E(v,e=>{e&&t.update(z.value.hpMemoryNum,e.registeredNaviCustomizerPrograms,e.cells)},{deep:!0}),J(()=>{c.fetchPrograms(),w.setSelectedBuildById(r.params.id),z||f.push({path:"/"}),g()});const l=()=>{z.value&&w.updateBuildById({id:z.value.id,registeredNaviCustomizerPrograms:v.value.registeredNaviCustomizerPrograms})},a=e=>{b.value=e},n=e=>{y.value=e},o=e=>{b.value&&v.value.addProgram({...y.value,id:v.value.registeredNaviCustomizerPrograms.length+1,programId:b.value.id,y:e.y,x:e.x})},u=e=>{const d=v.value.registeredNaviCustomizerPrograms.find(V=>V.id===e),R=p.value.find(V=>V.id===d.programId);v.value.removeProgram(e),b.value=R};return(e,d)=>{const R=oe,V=le,x=P("v-container"),O=pe,M=P("v-col"),A=he,Y=P("v-row"),Q=P("v-divider"),Z=se,ee=Pe,te=ke;return h(),N(q,null,[i(x,null,{default:m(()=>[i(R,null,{default:m(()=>[B(" ナビカスタマイザー ")]),_:1}),i(V,{onClick:l},{default:m(()=>[B(" 保存する ")]),_:1})]),_:1}),i(x,null,{default:m(()=>[i(Y,null,{default:m(()=>[i(M,{cols:"12",sm:"6"},{default:m(()=>[i(O,{"navi-customizer-status":C(s)},null,8,["navi-customizer-status"])]),_:1}),i(M,{cols:"12",sm:"6"},{default:m(()=>[i(A,{cells:C(S),"selected-program":C(b),"program-state":C(y),onAddProgram:o,onRemoveProgram:u},null,8,["cells","selected-program","program-state"])]),_:1})]),_:1})]),_:1}),i(Q),i(x,null,{default:m(()=>[i(Z,null,{default:m(()=>[B(" プログラム一覧 ")]),_:1}),i(Y,null,{default:m(()=>[i(M,{cols:"12",sm:"6"},{default:m(()=>[i(ee,{programs:C(p),"selected-program":C(b),onUpdateSelectedProgram:a},null,8,["programs","selected-program"])]),_:1}),i(M,{cols:"12",sm:"6"},{default:m(()=>[i(te,{"navi-customizer-program":C(b),onUpdateProgramState:n},null,8,["navi-customizer-program"])]),_:1})]),_:1})]),_:1})],64)}}});export{Ie as default};
